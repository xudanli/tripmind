# AI增强攻略搜索功能说明

## 概述

系统已集成AI（DeepSeek）来增强旅行攻略的搜索、推荐和排序功能，提供更智能、更精准的攻略推荐。

## AI功能模块

### 1. AI关键词生成 (`generateSearchKeywordsWithAI`)

**功能：** 根据目的地生成优化的搜索关键词

**优势：**
- 自动识别目的地的多种表达方式（中英文、别名）
- 包含热门景点、特色体验、文化关键词
- 生成精准的搜索词，提高搜索结果质量

**示例：**
- 输入：`日本`
- 输出：`["日本", "Japan", "东京攻略", "京都旅游", "日本自由行", "关西地区", "温泉之旅"]`

### 2. AI直接推荐 (`recommendGuidesWithAI`)

**功能：** 基于AI知识库直接生成攻略推荐

**优势：**
- 快速响应，无需等待搜索结果
- 基于AI的全球旅行知识库
- 涵盖多个维度：景点、美食、住宿、交通、文化、预算、贴士

**生成内容：**
- 标题：吸引人且具体的攻略标题
- 摘要：50-100字的攻略核心内容
- 标签：3-5个相关标签
- 来源：推荐平台（马蜂窝、携程、TripAdvisor等）

### 3. AI筛选和排序 (`filterAndSortGuidesWithAI`)

**功能：** 从搜索结果中智能筛选最相关的攻略并排序

**评估标准：**
1. 标题和内容与目的地的相关性（40分）
2. 内容的完整性和实用性（30分）
3. 来源的权威性（20分）
4. 内容的时效性（10分）

**优势：**
- 自动识别最相关的攻略
- 优先推荐知名平台的内容
- 考虑内容的实用性和时效性

### 4. AI评分排序 (`scoreGuidesWithAI`)

**功能：** 为每篇攻略打分并排序

**评分维度：**
- 相关性：40分
- 实用性：30分
- 权威性：20分
- 时效性：10分

## 工作流程

```
用户输入目的地
    ↓
1. 尝试从主API获取
    ↓ (如果失败或不足)
2. AI直接推荐攻略 ⭐ (快速且智能)
    ↓ (如果仍不足)
3. AI生成优化搜索关键词 ⭐
    ↓
4. 使用关键词搜索多个平台
    ↓ (如果仍不足)
5. RSS Feed补充
    ↓
6. AI筛选和排序 ⭐ (智能排序)
    ↓
7. 去重和返回结果
```

## 使用方式

### 基本使用（默认启用AI）

```typescript
import { getTravelGuides } from '@/services/guidesAPI'

// AI自动增强搜索和推荐
const guides = await getTravelGuides('日本', 50)
```

### 禁用AI（仅使用传统搜索）

```typescript
// 禁用AI，仅使用API和平台搜索
const guides = await getTravelGuides('日本', 50, true, false)
```

### 自定义配置

```typescript
const guides = await getTravelGuides(
  '日本',           // 目的地
  50,               // 数量限制
  true,             // 使用fallback
  true              // 使用AI增强
)
```

## AI优势

### 1. 智能关键词生成
- **传统方式：** 固定关键词 `"日本 攻略"`
- **AI方式：** 动态生成 `["日本", "Japan", "东京攻略", "京都旅游", "日本自由行", "关西地区", "温泉之旅"]`
- **效果：** 搜索结果更全面、更精准

### 2. 快速推荐
- **传统方式：** 需要等待搜索结果，可能返回空
- **AI方式：** 基于知识库直接生成推荐，立即返回
- **效果：** 用户体验更好，响应更快

### 3. 智能排序
- **传统方式：** 按时间或简单匹配度排序
- **AI方式：** 综合考虑相关性、实用性、权威性、时效性
- **效果：** 最相关的攻略排在前面

## 性能优化

### 1. 并行处理
- AI推荐和平台搜索可以并行执行
- 提高响应速度

### 2. 缓存策略
- AI生成的关键词可以缓存
- 相同目的地的后续请求可以直接使用

### 3. 降级机制
- AI失败时自动降级到传统搜索
- 保证功能的可用性

## 错误处理

### AI调用失败
- 自动降级到传统搜索方式
- 不影响整体功能

### AI解析失败
- 尝试多种解析方式
- 最终使用默认排序

### 超时控制
- AI调用有超时限制
- 避免长时间等待

## 配置选项

### 环境变量

```bash
# DeepSeek API配置（已在config/api.ts中配置）
DEEPSEEK_API_KEY=your_api_key
DEEPSEEK_BASE_URL=https://api.deepseek.com
```

### 代码配置

```typescript
// 在guidesAPI.ts中可以调整AI参数
{
  temperature: 0.7,    // 创造性（0-1）
  max_tokens: 4000     // 最大token数
}
```

## 使用示例

### 场景1：快速推荐
用户输入"日本"，AI立即生成10篇攻略推荐，涵盖：
- 必游景点路线
- 美食推荐
- 住宿建议
- 交通指南
- 文化体验
- 预算规划
- 实用贴士

### 场景2：智能搜索
用户输入"冰岛"，AI生成关键词：
- "冰岛"
- "Iceland"
- "极光之旅"
- "雷克雅未克"
- "黄金圈"

然后使用这些关键词搜索多个平台，AI筛选出最相关的攻略。

### 场景3：智能排序
从100篇搜索结果中，AI根据相关性、实用性、权威性、时效性评分，选出最值得阅读的50篇。

## 注意事项

1. **API成本：** AI调用会产生API费用，注意控制调用频率
2. **响应时间：** AI调用需要时间，用户体验上可能需要等待
3. **错误处理：** 确保AI失败时有完善的降级机制
4. **数据质量：** AI推荐的内容需要验证准确性

## 未来优化

- [ ] 添加缓存机制，减少重复AI调用
- [ ] 优化AI提示词，提高推荐质量
- [ ] 添加用户反馈机制，学习用户偏好
- [ ] 支持多语言AI推荐
- [ ] 添加推荐理由说明

