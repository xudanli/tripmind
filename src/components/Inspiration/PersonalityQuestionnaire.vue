<template>
  <div class="personality-questionnaire">
    <div class="questionnaire-header">
      <h2>äººæ ¼è¯†åˆ«é—®å·</h2>
      <p>å¸®åŠ©æˆ‘ä»¬äº†è§£ä½ çš„æ—…è¡Œå¿ƒç†éœ€æ±‚</p>
    </div>
    
    <!-- é—®å·å†…å®¹ -->
    <a-form :model="formData" layout="vertical" class="questionnaire-form">
      <a-card class="step-card">
        <!-- M åŠ¨æœº -->
        <div v-show="currentStep === 0" class="step-content">
          <div class="variable-section">
            <h3 class="variable-title">åŠ¨æœº (Motivation)</h3>
            
            <a-form-item label="Q1: è¿™æ¬¡æ—…è¡Œæœ€ä¸»è¦çš„åŸå› æ˜¯ï¼Ÿ" required>
              <a-radio-group v-model:value="formData.motivation">
                <a-radio value="é€ƒç¦»">é€ƒç¦»</a-radio>
                <a-radio value="æ¢ç´¢">æ¢ç´¢</a-radio>
                <a-radio value="æ•‘èµ">æ•‘èµ</a-radio>
                <a-radio value="é‡é€¢">é‡é€¢</a-radio>
                <a-radio value="é‡å¯">é‡å¯</a-radio>
              </a-radio-group>
            </a-form-item>
            
            <a-form-item label="Q2: ä½ å¸Œæœ›æ—…ç¨‹ç»“æŸåå¾—åˆ°ä»€ä¹ˆï¼Ÿ" required>
              <a-radio-group v-model:value="formData.motivation_detail">
                <a-radio value="å¹³é™">å¹³é™</a-radio>
                <a-radio value="çµæ„Ÿ">çµæ„Ÿ</a-radio>
                <a-radio value="åŠ›é‡">åŠ›é‡</a-radio>
                <a-radio value="ç†è§£">ç†è§£</a-radio>
                <a-radio value="å‹‡æ°”">å‹‡æ°”</a-radio>
              </a-radio-group>
            </a-form-item>
          </div>
        </div>
        
        <!-- E æƒ…ç»ª -->
        <div v-show="currentStep === 1" class="step-content">
          <div class="variable-section">
            <h3 class="variable-title">æƒ…ç»ª (Emotion)</h3>
            
            <a-form-item label="Q3: ä½ æœ€è¿‘æœ€å¸¸å‡ºç°çš„æƒ…ç»ªï¼Ÿ" required>
              <a-radio-group v-model:value="formData.dominant_emotion">
                <a-radio value="å€¦æ€ ">å€¦æ€ </a-radio>
                <a-radio value="ç„¦è™‘">ç„¦è™‘</a-radio>
                <a-radio value="å…´å¥‹">å…´å¥‹</a-radio>
                <a-radio value="å­¤ç‹¬">å­¤ç‹¬</a-radio>
                <a-radio value="å¥½å¥‡">å¥½å¥‡</a-radio>
              </a-radio-group>
            </a-form-item>
            
            <a-form-item label="Q4: ä½ æƒ³è®©æ—…ç¨‹å¸¦æ¥çš„ä¸»è¦æƒ…ç»ªï¼Ÿ" required>
              <a-radio-group v-model:value="formData.desired_emotion">
                <a-radio value="é‡Šæ”¾">é‡Šæ”¾</a-radio>
                <a-radio value="æ²»æ„ˆ">æ²»æ„ˆ</a-radio>
                <a-radio value="ç‡ƒçƒ§">ç‡ƒçƒ§</a-radio>
                <a-radio value="æ¸©æŸ”">æ¸©æŸ”</a-radio>
                <a-radio value="æƒŠå–œ">æƒŠå–œ</a-radio>
              </a-radio-group>
            </a-form-item>
          </div>
        </div>
        
        <!-- R èŠ‚å¥ -->
        <div v-show="currentStep === 2" class="step-content">
          <div class="variable-section">
            <h3 class="variable-title">èŠ‚å¥ (Rhythm)</h3>
            
            <a-form-item label="Q5: ä½ æ›´å–œæ¬¢å“ªç§æ—…ç¨‹èŠ‚å¥ï¼Ÿ" required>
              <a-radio-group v-model:value="formData.travel_rhythm">
                <a-radio value="å¿«èŠ‚å¥æ¢ç´¢">å¿«èŠ‚å¥æ¢ç´¢</a-radio>
                <a-radio value="ä¸­é€ŸæµåŠ¨">ä¸­é€ŸæµåŠ¨</a-radio>
                <a-radio value="æ…¢é€Ÿæ²‰æµ¸">æ…¢é€Ÿæ²‰æµ¸</a-radio>
              </a-radio-group>
            </a-form-item>
            
            <a-form-item label="Q6: ä¸€å¤©ç†æƒ³çš„æ´»åŠ¨ç»“æ„ï¼Ÿ" required>
              <a-radio-group v-model:value="formData.activity_density">
                <a-radio value="ç´§å‡‘å¤šæ ·">ç´§å‡‘å¤šæ ·</a-radio>
                <a-radio value="é€‚åº¦å®‰æ’">é€‚åº¦å®‰æ’</a-radio>
                <a-radio value="ç•™ç™½è‡ªç”±">ç•™ç™½è‡ªç”±</a-radio>
              </a-radio-group>
            </a-form-item>
          </div>
        </div>
        
        <!-- S ç¤¾äº¤ -->
        <div v-show="currentStep === 3" class="step-content">
          <div class="variable-section">
            <h3 class="variable-title">ç¤¾äº¤ (Social)</h3>
            
            <a-form-item label="Q7: ä½ å¸Œæœ›ä¸è°åŒè¡Œï¼Ÿ" required>
              <a-radio-group v-model:value="formData.social_preference">
                <a-radio value="ç‹¬è¡Œ">ç‹¬è¡Œ</a-radio>
                <a-radio value="ä¸€ä¸¤ä½æŒšå‹">ä¸€ä¸¤ä½æŒšå‹</a-radio>
                <a-radio value="ä¸€å°ç¾¤é™Œç”Ÿäºº">ä¸€å°ç¾¤é™Œç”Ÿäºº</a-radio>
              </a-radio-group>
            </a-form-item>
            
            <a-form-item label="Q8: ä¸äººäº’åŠ¨çš„é‡è¦æ€§ï¼Ÿ(1-5 åˆ†)" required>
              <a-slider
                v-model:value="formData.social_intensity"
                :min="1"
                :max="5"
                :marks="{ 1: '1', 2: '2', 3: '3', 4: '4', 5: '5' }"
              />
            </a-form-item>
          </div>
        </div>
        
        <!-- N éœ€æ±‚ -->
        <div v-show="currentStep === 4" class="step-content">
          <div class="variable-section">
            <h3 class="variable-title">éœ€æ±‚ (Need)</h3>
            
            <a-form-item label="Q9: ä½ æ›´å…³æ³¨å“ªä¸€å±‚ä½“éªŒï¼Ÿ" required>
              <a-radio-group v-model:value="formData.cognitive_need">
                <a-radio value="æ„Ÿå®˜">æ„Ÿå®˜</a-radio>
                <a-radio value="æ„ä¹‰">æ„ä¹‰</a-radio>
                <a-radio value="è¡ŒåŠ¨">è¡ŒåŠ¨</a-radio>
                <a-radio value="è½¬åŒ–">è½¬åŒ–</a-radio>
              </a-radio-group>
            </a-form-item>
            
            <a-form-item label="Q10: å¯¹æ—…ç¨‹åçš„å»¶ç»­æœŸå¾…ï¼Ÿ" required>
              <a-radio-group v-model:value="formData.post_journey_goal">
                <a-radio value="çŸ­æš‚å›å¿†">çŸ­æš‚å›å¿†</a-radio>
                <a-radio value="é•¿æœŸå½±å“">é•¿æœŸå½±å“</a-radio>
                <a-radio value="ç”Ÿæ´»æ”¹å˜">ç”Ÿæ´»æ”¹å˜</a-radio>
              </a-radio-group>
            </a-form-item>
            
            <a-form-item label="Q11: ä½ å¯¹ç¾é£Ÿä½“éªŒçš„åå¥½ï¼Ÿ" required>
              <a-radio-group v-model:value="formData.food_preference">
                <a-radio value="æ·±åº¦ç¾é£Ÿæ¢ç´¢">æ·±åº¦ç¾é£Ÿæ¢ç´¢</a-radio>
                <a-radio value="å½“åœ°ç‰¹è‰²ä½“éªŒ">å½“åœ°ç‰¹è‰²ä½“éªŒ</a-radio>
                <a-radio value="å¶å°”å°è¯•">å¶å°”å°è¯•</a-radio>
                <a-radio value="ç®€å•ä¾¿æ·">ç®€å•ä¾¿æ·</a-radio>
              </a-radio-group>
            </a-form-item>
          </div>
        </div>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <div class="step-actions">
          <a-button 
            v-if="currentStep > 0"
            size="large"
            @click="goPrev"
          >
            ä¸Šä¸€æ­¥
          </a-button>
          <a-button
            v-if="currentStep < steps.length - 1"
            type="primary"
            size="large"
            @click="goNext"
            :disabled="!isCurrentStepValid"
          >
            ä¸‹ä¸€æ­¥
          </a-button>
          <a-button
            v-if="currentStep === steps.length - 1"
            type="primary"
            size="large"
            @click="handleSubmit"
            :disabled="!isFormValid"
          >
            ç”Ÿæˆæ¨èç›®çš„åœ°
          </a-button>
        </div>
      </a-card>
    </a-form>
  </div>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue'
import { defineEmits } from 'vue'
import { message } from 'ant-design-vue'

export interface PersonalityProfile {
  motivation: string
  motivation_detail: string
  dominant_emotion: string
  desired_emotion: string
  travel_rhythm: string
  activity_density: string
  social_preference: string
  social_intensity: number
  cognitive_need: string
  post_journey_goal: string
  food_preference: string
}

const formData = ref<PersonalityProfile>({
  motivation: '',
  motivation_detail: '',
  dominant_emotion: '',
  desired_emotion: '',
  travel_rhythm: '',
  activity_density: '',
  social_preference: '',
  social_intensity: 3,
  cognitive_need: '',
  post_journey_goal: '',
  food_preference: ''
})

const currentStep = ref(0)

const steps = [
  { title: 'åŠ¨æœº', icon: 'ğŸ¯', key: 'motivation' },
  { title: 'æƒ…ç»ª', icon: 'ğŸ’­', key: 'emotion' },
  { title: 'èŠ‚å¥', icon: 'â±ï¸', key: 'rhythm' },
  { title: 'ç¤¾äº¤', icon: 'ğŸ‘¥', key: 'social' },
  { title: 'éœ€æ±‚', icon: 'âœ¨', key: 'need' }
]

const emit = defineEmits<{
  submit: [profile: PersonalityProfile]
}>()

// æ£€æŸ¥å½“å‰æ­¥éª¤æ˜¯å¦æœ‰æ•ˆ
const isCurrentStepValid = computed(() => {
  switch (currentStep.value) {
    case 0: // M åŠ¨æœº
      return formData.value.motivation !== '' && formData.value.motivation_detail !== ''
    case 1: // E æƒ…ç»ª
      return formData.value.dominant_emotion !== '' && formData.value.desired_emotion !== ''
    case 2: // R èŠ‚å¥
      return formData.value.travel_rhythm !== '' && formData.value.activity_density !== ''
    case 3: // S ç¤¾äº¤
      return formData.value.social_preference !== '' && formData.value.social_intensity > 0
    case 4: // N éœ€æ±‚
      return formData.value.cognitive_need !== '' && formData.value.post_journey_goal !== '' && formData.value.food_preference !== ''
    default:
      return false
  }
})

// æ£€æŸ¥æ•´ä¸ªè¡¨å•æ˜¯å¦æœ‰æ•ˆ
const isFormValid = computed(() => {
  return formData.value.motivation !== '' &&
         formData.value.motivation_detail !== '' &&
         formData.value.dominant_emotion !== '' &&
         formData.value.desired_emotion !== '' &&
         formData.value.travel_rhythm !== '' &&
         formData.value.activity_density !== '' &&
         formData.value.social_preference !== '' &&
         formData.value.cognitive_need !== '' &&
         formData.value.post_journey_goal !== '' &&
         formData.value.food_preference !== ''
})

const goNext = () => {
  if (isCurrentStepValid.value) {
    if (currentStep.value < steps.length - 1) {
      currentStep.value++
    }
  } else {
    message.warning('è¯·å®Œæˆå½“å‰æ­¥éª¤çš„æ‰€æœ‰é—®é¢˜')
  }
}

const goPrev = () => {
  if (currentStep.value > 0) {
    currentStep.value--
  }
}

const handleSubmit = () => {
  if (isFormValid.value) {
    emit('submit', { ...formData.value })
  } else {
    message.error('è¯·å®Œæˆæ‰€æœ‰é—®é¢˜')
  }
}
</script>

<style scoped>
.personality-questionnaire {
  max-width: 900px;
  margin: 0 auto;
}

.questionnaire-header {
  text-align: center;
  margin-bottom: 2rem;
}

.questionnaire-header h2 {
  font-size: 2rem;
  color: #1a1a1a;
  margin-bottom: 0.5rem;
}

.questionnaire-header p {
  color: #666;
  font-size: 1rem;
}

.questionnaire-form {
  margin-top: 2rem;
}

.step-card {
  min-height: 400px;
}

.step-content {
  min-height: 300px;
  padding: 1rem 0;
}

.variable-section {
  padding: 1.5rem;
}

.variable-title {
  margin-bottom: 1.5rem;
  font-size: 1.2rem;
  color: #1a1a1a;
  font-weight: 600;
}

.step-actions {
  display: flex;
  justify-content: space-between;
  margin-top: 2rem;
  padding-top: 1.5rem;
  border-top: 1px solid #e8e8e8;
}

:deep(.ant-radio-group) {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

:deep(.ant-slider) {
  margin: 1rem 0;
}

:deep(.ant-card-body) {
  padding: 2rem;
}
</style>
